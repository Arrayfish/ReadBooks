# [達人に学ぶDB設計徹底指南書](https://www.amazon.co.jp/dp/4798151953)

## 感想

### 1章

DDDのイベントストーミングの考え方はDOAなのかPOAなのかちょっとわからない。
始まりはプロセスからはいるけど、集約を考えるときにデータモデルを考えるので、DOA寄りなのかもしれない。

#### 演習問題 1-1

1.1. 使用しているDBのバージョン: 8.0.mysql_aurora.3.04.0
1.2. 最新のバージョン: 8.0.mysql_aurora.3.11.0
2. エディション: ??
3. マニュアルや公式ドキュメントの所在: [AWSのユーザガイド](https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Aurora.AuroraMySQL.html)

### 2章 論理設計と物理設計

物理設計のオンプレの方の話が知らないことが多くて面白い。

物理設計のステップ

1. テーブル定義
2. インデックス定義
3. ハードウェアのサイジング
4. ストレージの冗長構成の決定(RAIDなど)
5. ファイルの物理配置の決定

#### ハードウェアのサイジング

ハードウェアのサイジングの話
サイジングはキャパシティ(データ保存量)とパフォーマンス(処理能力)の2つの観点で考える。
DBのパフォーマンスの問題の8割はストレージI/Oが原因

パフォーマンスの性能要件は応答時間とスループットの二つの指標で考える
判断する根拠は他のシステムから持ってくるか、プロトタイプを作るか
予算という大きな制約があることを忘れないこと

#### データベースファイルの物理配置

データベースに格納されるファイル

- データファイル
- インデックスファイル
- システムファイル
- 一時ファイル: サブルエリの展開したデータやgroup byのソートデータなど
- ログファイル: REDOログ, トランザクションログなど

#### レプリケーション

現用系から待機系へ更新データを送信して同期する仕組み

- 同期レプリケーション: 全部のレプリカを更新してからコミット終了
- 非同期レプリケーション: メインを更新したらすぐにコミット終了

- 物理レプリケーション: トランザクションログそのものを転送
- 論理レプリケーション: 論理的な更新情報(SQLなど)を転送

#### リカバリとリストア

- リカバリ: トランザクションログを適用して変更文を反映する
- リストア: バックアップファイルを戻すこと

#### 演習問題

##### 2.1. データベースサーバのクラスタリング構成

アクティブ、アクティブ型: 複数のノード間で負荷分散をする
アクティブ、スタンバイ型: レプリケーションで待機系に同期する

##### 2.2. ハードウェアリソースの情報取得

- linuxの場合
  - ディスク: du?
  - メモリ: 
  - cpu利用率: 

##### 2.3. サーバCPUの机上サイジング

### 3章 論理設計と正規化

正規化のポイント

- 正規化は更新時の不都合/不整合を排除するために行う
- 正規化は従属性を見抜くことが必要なので、業務ロジックの理解が必要
- 正規化はいつでも非正規化に戻せる

原則としては3NFまで行う

### 6章　データベースとパフォーマンス

レコード数が10万件以下の場合はインデックスにほとんど意味がない

#### インデックス以外のチューニング手法

- パーティショニング
- パラレルクエリ
- ヒント句
- オンメモリ

なんか自然キーと代理キーの話が腑に落ちていない。
今までは基本的には代理キーを使って一意性を保証していて、自然キーはユニーク制約で保証していた。
