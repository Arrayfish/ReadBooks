# 単体テストの使い方考え方

## 第一部 単体(unit)テストとは

### 第1章 なぜ、単体テストを行うのか?

単体テストの目的は、ソフトウェア開発プロジェクトの成長を持続可能にすること。  
単体テストを作らない場合は開発が進むに連れてソフトウェア・エントロピーが肥大化し、退行が多発して開発を続けられなくなる。
質の良いテストでないと、ソフtウェア・エントロピーの増加を防ぐことができない。  

#### テストコードの質

網羅率からは実際のテスト対象のコードが検証されたのか確認できず、外部ライブラリも対象にならない。  
網羅率からはテストコードの質が悪いことはわかるが、良いかどうかはわからない。  

優れたテスト・スイートの特徴

- テストすることが、開発サイクルに組み込まれている
- コードベースの特に重要な部分のみがテスト対象になっている。
- 最小限の保守個スロットで最大の価値を生み出すようにする

### 第2章 単体テストとは何か?

単語の定義とかの話  
テスト対象システム: SUT(System Under Test)  
単体テストが持っているべき性質“

- 「単体(unit)」と呼ばれる少量のコードを検証すること
- 実行時間が短いこと
- 隔離された状態で実行されること

#### 共有依存、プライベート依存、揮発性依存の違い

- 共有依存: テストケース間で共有される依存これがあると複数のテストケースを並列で実行できない(DBなど)
- プライベート依存: 共有されない依存
- プロセス外依存: アプリケーションの外部にある依存、共有依存である場合が多い。専用のDBや読み込み専用のDBなどプライベート依存の場合もある。

#### 単体テストにおける２学派、古典学派とロンドン学派

主に3つの観点において違いがある

|           |隔離対象   |単体の意味                                           |テスト・ダブルの置き換え対象|
|---|---|---|---|
|ロンドン学派|単体       |1つのクラス                                          |普遍依存を除く全ての依存    |
|古典学派    |テストケース|1つのクラス、もしくは同じ目的を達成するためのクラスの1グループ|共有依存                 |

この本では古典学派の観点で単体テストを行う。

#### 単体テスト、統合テスト、E2Eテストの違い

- 単体テストが持つべき性質が1つでも欠けた場合にはそれは統合テストになる。
- E2Eテストは統合テストの1種であり、プロセス外依存をそのまま使ってテストする。

### 第3章 単体テストの構造的解析

単体テストの全てのテスト・ケースは準備(Arrange), 実行(Act), 検証(Assert)の3つのフェーズで構成されるAAAパターンであるべき  
各フェーズは1度のみ実行されるべき。そうでない場合は1つのテストケースで複数の振る舞いをテストしていることになる。  
実行フェーズのコードが1行を越す場合はAPIの設計がおかしい  
テスト・メソッド名は厳密な命名規則の使用を避け、テスト・メソッド名は問題領域に精通している非開発者にも伝わる事実をつけるようにする。  
テスト対象のメソッド名を名前に入れるのは止める  

## 第2部 単体テストとその価値

### 第４章 良い単体テストを構成する４本の柱

4本の柱

- 退行の検出
- リファクタリング耐性
- 迅速な実行
- 保守のしやすさ

保守のしやすさ以外の3つにはトレードオフが発生する。
リファクタリング耐性は0/1しかないので、退行の検出と迅速な実行の間でバランスをとる必要がある。

E2Eテスト退行への検出とリファクタリング耐性の両方があるのは意外だった。
リファクタリング耐性がないかと思っていた。
単純に保守のしやすさと迅速な実行ができないだけだった。


### 第5章 モックの利用とテストの壊れやすさ

### 第6章 単体テストの3つの手法

### 第7章 単体テストの価値を高めるリファクタリング

ここまでは読んだ

## 第3部 結合(integration)テスト

### 第8章 なぜ、統合(integration)テストを行うのか？

管理下の依存と管理外の依存がある。
観察可能な振る舞いをもつかどうかで管理下の依存と管理外の依存を区別する。
例えば、テスト対象モジュールしか使用していない場合は、プロセス外依存だとしても管理下の依存として扱う。

管理下の依存では結合テストではモックを使わずに、そのままを使用して問題ない。

### 第9章 モックのベストプラクティス

### 第10章 データベースに対するテスト

## 第4部 単体テストのアンチ・パターン

### 第11章 単体テストのアンチ・パターン
